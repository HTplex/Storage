package playground.southafrica.projects.treasury2014;

import java.io.File;

import org.apache.log4j.Logger;

import playground.southafrica.population.census2011.PopulationBuilder2011;
import playground.southafrica.utilities.Header;

/**
 * Class to automate the process of generating full populations from the output
 * generated by the multi-level iterative proportional fitting (MLIPF) 
 * runs for all the {@link StudyAreas}.
 *
 * @author jwjoubert
 */
public class GeneratePopulations {
	private final static Logger LOG = Logger.getLogger(GeneratePopulations.class);

	public static void main(String[] args) {
		Header.printHeader(GeneratePopulations.class.toString(), args);
		run(args);
		Header.printFooter();
	}
	
	/**
	 * Executes the population generation for all {@link StudyAreas}.
	 * 
	 * @param args the following arguments are required:
	 * <ol>
	 * 		<li> folder containing the multi-level iterative proportional 
	 * 			fitting output (should contain one folder per {@link 
	 * 			StudyAreas};
	 * 		<li> folder where output populations will be written. Each area
	 * 			will be written to its own subfolder.
	 * </ol>
	 */
	public static void run(String[] args){
		String inputFolder = args[0];
		String outputFolder = args[1];
		
		for(StudyAreas area : StudyAreas.values()){
			LOG.info("------------------------------------------------------------------------------");
			LOG.info(" Generating population from MLIPF output for " + area.getName());
			LOG.info("------------------------------------------------------------------------------");
			String areaInputFolder = inputFolder + (inputFolder.endsWith("/") ? "" : "/") + area.getName() + "/";
			String areaOutputFolder = outputFolder + (outputFolder.endsWith("/") ? "" : "/") + area.getName() + "/";
			/* Warn if output folder already exists. */
			File f = new File(areaOutputFolder);
			if(f.exists()){
				throw new RuntimeException(areaOutputFolder + "already exists and will be not be deleted!");
			}
			if(f.mkdirs()){
				LOG.info("Area directory successfully created at " + areaOutputFolder);
			} else{
				throw new RuntimeException("Could not create area directory " + areaOutputFolder);
			}
			
			String[] runArguments = {
					areaInputFolder,
					"/home/jwjoubert/workspace/Shapefiles/" + area.getName() + "/zones/" + area.getName() + "_SP2011_SA-Albers.shp",
					"1",
					areaOutputFolder
			};
			PopulationBuilder2011.run(runArguments);
			
			LOG.info("==> done with " + area.getName());
		}
		
	}

}
